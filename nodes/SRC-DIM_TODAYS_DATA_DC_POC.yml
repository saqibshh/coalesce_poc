fileVersion: 1
id: 836d61d1-4e42-4fe9-a7f6-f6771926179f
name: DIM_TODAYS_DATA_DC_POC
operation:
  config:
    postSQL: ""
    preSQL: |-
      -- SCD Type 2 Implementation: Mark existing records as inactive before inserting new versions
      UPDATE {{ ref('SRC', 'DC_POC') }} 
      SET active = FALSE, 
          updated_at = CURRENT_TIMESTAMP()
      WHERE id IN (
        SELECT DISTINCT t.id 
        FROM {{ ref('SRC', 'V_TODAYS_DATA') }} t
        INNER JOIN {{ ref('SRC', 'V_DC_POC') }} d ON t.id = d.id
        WHERE d.active = TRUE 
        AND (t.name != d.name OR t.name IS NULL != d.name IS NULL)
      );
    testsEnabled: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: SRC
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e0e11bb0-61ef-475b-9915-e4215456916c
          stepCounter: 836d61d1-4e42-4fe9-a7f6-f6771926179f
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        isBusinessKey: true
        name: ID
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 469f4596-8d2b-419c-bf0f-f52dfbea41b5
                stepCounter: b9d1ebac-2cda-47f1-9810-bda9592ad0c6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 82df61d8-a538-4e95-8da0-bf6ae78a6166
          stepCounter: 836d61d1-4e42-4fe9-a7f6-f6771926179f
        config: {}
        dataType: VARCHAR(16777216)
        description: ""
        isChangeTracking: true
        name: NAME
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 324777f7-b64f-4b64-adb1-b2f292108cfa
                stepCounter: b9d1ebac-2cda-47f1-9810-bda9592ad0c6
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 85ad168f-f9f5-4020-a222-6e5e855df5c7
          stepCounter: 836d61d1-4e42-4fe9-a7f6-f6771926179f
        config: {}
        dataType: BOOLEAN
        description: ""
        isChangeTracking: true
        name: ACTIVE
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2942916a-0ad1-4229-8a5f-bd74c838b665
                stepCounter: 1ed7700b-fa23-47ff-aad0-2ecf93f42fca
            transform: "TRUE"
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 61ac1b0b-e9fd-477e-b3fd-f466ebff5181
          stepCounter: 836d61d1-4e42-4fe9-a7f6-f6771926179f
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        isChangeTracking: true
        name: CREATED_AT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 843f37ed-31df-4785-b560-7f3796b3436d
                stepCounter: 1ed7700b-fa23-47ff-aad0-2ecf93f42fca
            transform: CURRENT_TIMESTAMP()
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 795b56c0-2962-439b-96f8-68b748e4f4dd
          stepCounter: 836d61d1-4e42-4fe9-a7f6-f6771926179f
        config: {}
        dataType: TIMESTAMP_NTZ(9)
        description: ""
        isChangeTracking: true
        name: UPDATED_AT
        nullable: false
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 5148527b-4c17-4a93-96b5-548da18df614
                stepCounter: 1ed7700b-fa23-47ff-aad0-2ecf93f42fca
            transform: CURRENT_TIMESTAMP()
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          V_DC_POC: 1ed7700b-fa23-47ff-aad0-2ecf93f42fca
          V_TODAYS_DATA: b9d1ebac-2cda-47f1-9810-bda9592ad0c6
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: SRC
            nodeName: V_DC_POC
          - locationName: SRC
            nodeName: V_TODAYS_DATA
        join:
          joinCondition: |-
            FROM {{ ref('SRC', 'V_TODAYS_DATA') }} "V_TODAYS_DATA"
            INNER JOIN {{ ref('SRC', 'V_DC_POC') }} "V_DC_POC"
            ON "TODAYS_DATA".id = "DC_POC".id AND "DC_POC".active = TRUE
            WHERE "DC_POC".id IS NULL OR ("TODAYS_DATA".name != "DC_POC".name OR "TODAYS_DATA".name IS NULL != "DC_POC".name IS NULL)
        name: DIM_TODAYS_DATA_DC_POC
        noLinkRefs: []
  name: DIM_TODAYS_DATA_DC_POC
  overrideSQL: false
  schema: ""
  sqlType: Dimension
  type: sql
  version: 1
type: Node
